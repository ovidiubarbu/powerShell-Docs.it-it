---
ms.date: 06/05/2017
keywords: powershell,cmdlet
title: WinRMSecurity
ms.openlocfilehash: 59717e4806857e6760de523335bbee6028da8e84
ms.sourcegitcommit: 6545c60578f7745be015111052fd7769f8289296
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 04/22/2020
ms.locfileid: "62086365"
---
# <a name="powershell-remoting-security-considerations"></a><span data-ttu-id="afce5-103">Considerazioni sulla sicurezza della comunicazione remota di PowerShell</span><span class="sxs-lookup"><span data-stu-id="afce5-103">PowerShell Remoting Security Considerations</span></span>

<span data-ttu-id="afce5-104">La comunicazione remota di PowerShell è il metodo consigliato per gestire i sistemi Windows.</span><span class="sxs-lookup"><span data-stu-id="afce5-104">PowerShell Remoting is the recommended way to manage Windows systems.</span></span> <span data-ttu-id="afce5-105">La comunicazione remota di PowerShell è abilitata per impostazione predefinita su Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="afce5-105">PowerShell Remoting is enabled by default in Windows Server 2012 R2.</span></span> <span data-ttu-id="afce5-106">Questo documento illustra i problemi di sicurezza, i suggerimenti e le procedure consigliate per la comunicazione remota di PowerShell.</span><span class="sxs-lookup"><span data-stu-id="afce5-106">This document covers security concerns, recommendations, and best practices when using PowerShell Remoting.</span></span>

## <a name="what-is-powershell-remoting"></a><span data-ttu-id="afce5-107">Informazioni sulla comunicazione remota di PowerShell</span><span class="sxs-lookup"><span data-stu-id="afce5-107">What is PowerShell Remoting?</span></span>

<span data-ttu-id="afce5-108">La comunicazione remota di PowerShell usa la [Gestione remota Windows (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426.aspx), ovvero l'implementazione Microsoft del protocollo [Web Services for Management (WS-Management)](https://www.dmtf.org/sites/default/files/standards/documents/DSP0226_1.2.0.pdf), per consentire agli utenti di eseguire i comandi di PowerShell nei computer remoti.</span><span class="sxs-lookup"><span data-stu-id="afce5-108">PowerShell Remoting uses [Windows Remote Management (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426.aspx), which is the Microsoft implementation of the [Web Services for Management (WS-Management)](https://www.dmtf.org/sites/default/files/standards/documents/DSP0226_1.2.0.pdf) protocol, to allow users to run PowerShell commands on remote computers.</span></span> <span data-ttu-id="afce5-109">È possibile trovare altre informazioni sull'uso della comunicazione remota di PowerShell in [Esecuzione di comandi remoti](https://technet.microsoft.com/library/dd819505.aspx).</span><span class="sxs-lookup"><span data-stu-id="afce5-109">You can find more information about using PowerShell Remoting at [Running Remote Commands](https://technet.microsoft.com/library/dd819505.aspx).</span></span>

<span data-ttu-id="afce5-110">La comunicazione remota di PowerShell non corrisponde all'uso del parametro **ComputerName** di un cmdlet per l'esecuzione in un computer remoto che usa RPC (Remote Procedure Call) come protocollo sottostante.</span><span class="sxs-lookup"><span data-stu-id="afce5-110">PowerShell Remoting is not the same as using the **ComputerName** parameter of a cmdlet to run it on a remote computer, which uses Remote Procedure Call (RPC) as its underlying protocol.</span></span>

## <a name="powershell-remoting-default-settings"></a><span data-ttu-id="afce5-111">Impostazioni predefinite della comunicazione remota di PowerShell</span><span class="sxs-lookup"><span data-stu-id="afce5-111">PowerShell Remoting default settings</span></span>

<span data-ttu-id="afce5-112">La comunicazione remota di PowerShell (e WinRM) esegue l'ascolto delle porte seguenti:</span><span class="sxs-lookup"><span data-stu-id="afce5-112">PowerShell Remoting (and WinRM) listen on the following ports:</span></span>

- <span data-ttu-id="afce5-113">HTTP: 5985</span><span class="sxs-lookup"><span data-stu-id="afce5-113">HTTP: 5985</span></span>
- <span data-ttu-id="afce5-114">HTTPS: 5986</span><span class="sxs-lookup"><span data-stu-id="afce5-114">HTTPS: 5986</span></span>

<span data-ttu-id="afce5-115">Per impostazione predefinita, la comunicazione remota di PowerShell consente connessioni solo dai membri del gruppo degli amministratori.</span><span class="sxs-lookup"><span data-stu-id="afce5-115">By default, PowerShell Remoting only allows connections from members of the Administrators group.</span></span> <span data-ttu-id="afce5-116">Le sessioni vengono avviate nel contesto utente, quindi tutti i controlli di accesso del sistema operativo applicati a singoli utenti e gruppi continuano a essere applicati con la comunicazione remota di PowerShell.</span><span class="sxs-lookup"><span data-stu-id="afce5-116">Sessions are launched under the user's context, so all operating system access controls applied to individual users and groups continue to apply to them while connected over PowerShell Remoting.</span></span>

<span data-ttu-id="afce5-117">Sulle reti private, la regola del firewall di Windows predefinita per la comunicazione remota di PowerShell accetta tutte le connessioni.</span><span class="sxs-lookup"><span data-stu-id="afce5-117">On private networks, the default Windows Firewall rule for PowerShell Remoting accepts all connections.</span></span> <span data-ttu-id="afce5-118">Sulle reti pubbliche la regola Firewall di Windows predefinita consente le connessioni della comunicazione remota di PowerShell solo dall'interno della stessa subnet.</span><span class="sxs-lookup"><span data-stu-id="afce5-118">On public networks, the default Windows Firewall rule allows PowerShell Remoting connections only from within the same subnet.</span></span> <span data-ttu-id="afce5-119">È necessario modificare in modo esplicito tale regola per aprire la comunicazione remota di PowerShell per tutte le connessioni di una rete pubblica.</span><span class="sxs-lookup"><span data-stu-id="afce5-119">You have to explicitly change that rule to open PowerShell Remoting to all connections on a public network.</span></span>

><span data-ttu-id="afce5-120">**Avviso:** la regola del firewall per le reti pubbliche è progettata per proteggere il computer da tentativi di connessione esterna potenzialmente dannosi.</span><span class="sxs-lookup"><span data-stu-id="afce5-120">**Warning:** The firewall rule for public networks is meant to protect the computer from potentially malicious external connection attempts.</span></span> <span data-ttu-id="afce5-121">Prestare attenzione quando si rimuove questa regola.</span><span class="sxs-lookup"><span data-stu-id="afce5-121">Use caution when removing this rule.</span></span>

## <a name="process-isolation"></a><span data-ttu-id="afce5-122">Isolamento del processo</span><span class="sxs-lookup"><span data-stu-id="afce5-122">Process isolation</span></span>

<span data-ttu-id="afce5-123">La comunicazione remota di PowerShell usa [Gestione remota Windows (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426) per la comunicazione tra computer.</span><span class="sxs-lookup"><span data-stu-id="afce5-123">PowerShell Remoting uses [Windows Remote Management (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426) for communication between computers.</span></span>
<span data-ttu-id="afce5-124">WinRM viene eseguito come servizio dell'account del servizio di rete e genera processi isolati eseguiti come account utente per ospitare le istanze di PowerShell.</span><span class="sxs-lookup"><span data-stu-id="afce5-124">WinRM runs as a service under the Network Service account, and spawns isolated processes running as user accounts to host PowerShell instances.</span></span> <span data-ttu-id="afce5-125">Un'istanza di PowerShell in esecuzione per un solo utente non ha accesso a un processo che esegue un'istanza di PowerShell con un altro account utente.</span><span class="sxs-lookup"><span data-stu-id="afce5-125">An instance of PowerShell running as one user has no access to a process running an instance of PowerShell as another user.</span></span>

## <a name="event-logs-generated-by-powershell-remoting"></a><span data-ttu-id="afce5-126">Registri eventi generati dalla comunicazione remota di Powershell</span><span class="sxs-lookup"><span data-stu-id="afce5-126">Event logs generated by PowerShell Remoting</span></span>

<span data-ttu-id="afce5-127">FireEye ha fornito un ottimo riepilogo dei registri eventi e di altre prove relative alla sicurezza generato dalle sessioni di comunicazione remota di PowerShell, disponibile in [Investigating PowerShell Attacks](https://www.fireeye.com/content/dam/fireeye-www/global/en/solutions/pdfs/wp-lazanciyan-investigating-powershell-attacks.pdf) (Ricerche sugli attacchi a PowerShell).</span><span class="sxs-lookup"><span data-stu-id="afce5-127">FireEye has provided a good summary of the event logs and other security evidence generated by PowerShell Remoting sessions, available at [Investigating PowerShell Attacks](https://www.fireeye.com/content/dam/fireeye-www/global/en/solutions/pdfs/wp-lazanciyan-investigating-powershell-attacks.pdf).</span></span>

## <a name="encryption-and-transport-protocols"></a><span data-ttu-id="afce5-128">Protocolli di trasporto e crittografia</span><span class="sxs-lookup"><span data-stu-id="afce5-128">Encryption and transport protocols</span></span>

<span data-ttu-id="afce5-129">È utile valutare la sicurezza di una connessione della comunicazione remota di PowerShell da due prospettive: l'autenticazione iniziale e la comunicazione continua.</span><span class="sxs-lookup"><span data-stu-id="afce5-129">It is helpful to consider the security of a PowerShell Remoting connection from two perspectives: initial authentication, and ongoing communication.</span></span>

<span data-ttu-id="afce5-130">Indipendentemente dal protocollo di trasporto usato (HTTP o HTTPS), la comunicazione remota di PowerShell esegue sempre la crittografia su tutte le comunicazioni dopo l'autenticazione iniziale con una chiave simmetrica AES-256 per ogni sessione.</span><span class="sxs-lookup"><span data-stu-id="afce5-130">Regardless of the transport protocol used (HTTP or HTTPS), PowerShell Remoting always encrypts all communication after initial authentication with a per-session AES-256 symmetric key.</span></span>

### <a name="initial-authentication"></a><span data-ttu-id="afce5-131">Autenticazione iniziale</span><span class="sxs-lookup"><span data-stu-id="afce5-131">Initial authentication</span></span>

<span data-ttu-id="afce5-132">L'autenticazione conferma l'identità del client al server e, idealmente, l'identità del server al client.</span><span class="sxs-lookup"><span data-stu-id="afce5-132">Authentication confirms the identity of the client to the server - and ideally - the server to the client.</span></span>

<span data-ttu-id="afce5-133">Quando un client si connette a un server di dominio usando il proprio nome di computer, ad esempio server01 o server01. contoso.com, il protocollo di autenticazione predefinito è [Kerberos](https://msdn.microsoft.com/library/windows/desktop/aa378747.aspx).</span><span class="sxs-lookup"><span data-stu-id="afce5-133">When a client connects to a domain server using its computer name (i.e.: server01, or server01.contoso.com), the default authentication protocol is [Kerberos](https://msdn.microsoft.com/library/windows/desktop/aa378747.aspx).</span></span>
<span data-ttu-id="afce5-134">Kerberos garantisce l'identità dell'utente e l'identità del server senza inviare credenziali riutilizzabili.</span><span class="sxs-lookup"><span data-stu-id="afce5-134">Kerberos guarantees both the user identity and server identity without sending any sort of reusable credential.</span></span>

<span data-ttu-id="afce5-135">Quando un client si connette a un server di dominio tramite il relativo indirizzo IP o si connette a un server del gruppo di lavoro, l'autenticazione Kerberos non può essere applicata.</span><span class="sxs-lookup"><span data-stu-id="afce5-135">When a client connects to a domain server using its IP address, or connects to a workgroup server, Kerberos authentication is not possible.</span></span> <span data-ttu-id="afce5-136">In questo caso la comunicazione remota di PowerShell si basa sul [protocollo di autenticazione NTLM](https://msdn.microsoft.com/library/windows/desktop/aa378749.aspx),</span><span class="sxs-lookup"><span data-stu-id="afce5-136">In that case, PowerShell Remoting relies on the [NTLM authentication protocol](https://msdn.microsoft.com/library/windows/desktop/aa378749.aspx).</span></span> <span data-ttu-id="afce5-137">che garantisce l'identità dell'utente senza che sia necessario inviare credenziali delegabili.</span><span class="sxs-lookup"><span data-stu-id="afce5-137">The NTLM authentication protocol guarantees the user identity without sending any sort of delegable credential.</span></span> <span data-ttu-id="afce5-138">Per dimostrare l'identità dell'utente, il protocollo NTLM richiede che sia il client che il server calcolino una chiave di sessione dalla password dell'utente senza mai scambiare la stessa password.</span><span class="sxs-lookup"><span data-stu-id="afce5-138">To prove user identity, the NTLM protocol requires that both the client and server compute a session key from the user's password without ever exchanging the password itself.</span></span> <span data-ttu-id="afce5-139">Il server in genere non conosce la password dell'utente, quindi comunica con il controller di dominio, che conosce la password e calcola la chiave della sessione per il server.</span><span class="sxs-lookup"><span data-stu-id="afce5-139">The server typically does not know the user's password, so it communicates with the domain controller, which does know the user's password and calculates the session key for the server.</span></span>

<span data-ttu-id="afce5-140">Il protocollo NTLM, tuttavia, garantisce l'identità del server.</span><span class="sxs-lookup"><span data-stu-id="afce5-140">The NTLM protocol does not, however, guarantee server identity.</span></span> <span data-ttu-id="afce5-141">Come con tutti i protocolli che usano NTLM per l'autenticazione, un utente malintenzionato con accesso all'account computer di un computer aggiunto al dominio può richiamare il controller di dominio per calcolare una chiave di sessione NTLM e quindi rappresentare il server.</span><span class="sxs-lookup"><span data-stu-id="afce5-141">As with all protocols that use NTLM for authentication, an attacker with access to a domain-joined computer's machine account could invoke the domain controller to compute an NTLM session-key and thereby impersonate the server.</span></span>

<span data-ttu-id="afce5-142">L'autenticazione basata su NTLM è disabilitata per impostazione predefinita, ma è ammessa una configurazione di SSL nel server di destinazione o la configurazione dell'impostazione TrustedHosts di WinRM.</span><span class="sxs-lookup"><span data-stu-id="afce5-142">NTLM-based authentication is disabled by default, but may be permitted by either configuring SSL on the target server, or by configuring the WinRM TrustedHosts setting on the client.</span></span>

#### <a name="using-ssl-certificates-to-validate-server-identity-during-ntlm-based-connections"></a><span data-ttu-id="afce5-143">Uso di certificati SSL per convalidare l'identità del server durante le connessioni basate su NTLM</span><span class="sxs-lookup"><span data-stu-id="afce5-143">Using SSL certificates to validate server identity during NTLM-based connections</span></span>

<span data-ttu-id="afce5-144">Poiché il protocollo di autenticazione NTLM non è in grado di garantire l'identità del server di destinazione, a meno che non conosca già la password, è possibile configurare i server di destinazione per l'uso di SSL per la comunicazione remota di PowerShell.</span><span class="sxs-lookup"><span data-stu-id="afce5-144">Since the NTLM authentication protocol cannot ensure the identity of the target server (only that it already knows your password), you can configure target servers to use SSL for PowerShell Remoting.</span></span> <span data-ttu-id="afce5-145">L'assegnazione di un certificato SSL al server di destinazione, se emesso da un'autorità di certificazione che anche il client considera attendibile, consente l'autenticazione basata su NTLM, che garantisce l'identità sia dell'utente che del server.</span><span class="sxs-lookup"><span data-stu-id="afce5-145">Assigning a SSL certificate to the target server (if issued by a Certificate Authority that the client also trusts) enables NTLM-based authentication that guarantees both the user identity and server identity.</span></span>

#### <a name="ignoring-ntlm-based-server-identity-errors"></a><span data-ttu-id="afce5-146">Ignorare gli errori di identità del server basata su NTLM</span><span class="sxs-lookup"><span data-stu-id="afce5-146">Ignoring NTLM-based server identity errors</span></span>

<span data-ttu-id="afce5-147">Se la distribuzione di un certificato SSL a un server per le connessioni NTLM non è applicabile, è possibile eliminare gli errori di identità risultanti aggiungendo il server all'elenco **TrustedHosts** di WinRM.</span><span class="sxs-lookup"><span data-stu-id="afce5-147">If deploying a SSL certificate to a server for NTLM connections is infeasible, you may suppress the resulting identity errors by adding the server to the WinRM **TrustedHosts** list.</span></span> <span data-ttu-id="afce5-148">Si noti che l'aggiunta del nome di un server all'elenco TrustedHosts non deve essere considerata una dichiarazione di attendibilità degli stessi host, poiché il protocollo di autenticazione NTLM non è in grado di garantire che venga effettivamente eseguita la connessione all'host a cui si intende connettersi.</span><span class="sxs-lookup"><span data-stu-id="afce5-148">Please note that adding a server name to the TrustedHosts list should not be considered as any form of statement of the trustworthiness of the hosts themselves - as the NTLM authentication protocol cannot guarantee that you are in fact connecting to the host you are intending to connect to.</span></span>
<span data-ttu-id="afce5-149">In alternativa, considerare l'impostazione di TrustedHosts come elenco degli host per i quali eliminare l'errore generato dall'impossibilità di verificare l'identità del server.</span><span class="sxs-lookup"><span data-stu-id="afce5-149">Instead, you should consider the TrustedHosts setting to be the list of hosts for which you wish to suppress the error generated by being unable to verify the server's identity.</span></span>


### <a name="ongoing-communication"></a><span data-ttu-id="afce5-150">Comunicazione continua</span><span class="sxs-lookup"><span data-stu-id="afce5-150">Ongoing Communication</span></span>

<span data-ttu-id="afce5-151">Dopo aver completato l'autenticazione iniziale, il [Protocollo di comunicazione remota di PowerShell](https://msdn.microsoft.com/library/dd357801.aspx) esegue la crittografia di tutte le comunicazioni in corso con una chiave simmetrica AES-256 per ogni sessione.</span><span class="sxs-lookup"><span data-stu-id="afce5-151">Once initial authentication is complete, the [PowerShell Remoting Protocol](https://msdn.microsoft.com/library/dd357801.aspx) encrypts all ongoing communication with a per-session AES-256 symmetric key.</span></span>


## <a name="making-the-second-hop"></a><span data-ttu-id="afce5-152">Esecuzione del secondo hop</span><span class="sxs-lookup"><span data-stu-id="afce5-152">Making the second hop</span></span>

<span data-ttu-id="afce5-153">Per impostazione predefinita, la comunicazione remota di PowerShell usa Kerberos (se disponibile) o NTLM per l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="afce5-153">By default, PowerShell Remoting uses Kerberos (if available) or NTLM for authentication.</span></span> <span data-ttu-id="afce5-154">Entrambi questi protocolli eseguono l'autenticazione al computer remoto senza inviare le credenziali.</span><span class="sxs-lookup"><span data-stu-id="afce5-154">Both of these protocols authenticate to the remote machine without sending credentials to it.</span></span>
<span data-ttu-id="afce5-155">Si tratta del modo più sicuro per eseguire l'autenticazione. Tuttavia, dal momento che il computer remoto non dispone delle credenziali dell'utente, non può accedere ad altri computer e servizi per conto dell'utente.</span><span class="sxs-lookup"><span data-stu-id="afce5-155">This is the most secure way to authenticate, but because the remote machine does not have the user's credentials, it cannot access other computers and services on the user's behalf.</span></span>
<span data-ttu-id="afce5-156">Ciò è noto come "problema del secondo hop".</span><span class="sxs-lookup"><span data-stu-id="afce5-156">This is known as the "second hop problem".</span></span>

<span data-ttu-id="afce5-157">Ci sono diversi modi per evitare questo problema.</span><span class="sxs-lookup"><span data-stu-id="afce5-157">There are several ways to avoid this problem.</span></span> <span data-ttu-id="afce5-158">Per le descrizioni di questi metodi e dei vantaggi e svantaggi di ogni metodo, vedere [Creazione del secondo hop nella comunicazione remota di PowerShell](PS-remoting-second-hop.md).</span><span class="sxs-lookup"><span data-stu-id="afce5-158">For descriptions of these methods, and the pros and cons of each, see [Making the second hop in PowerShell Remoting](PS-remoting-second-hop.md).</span></span>